<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Documentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Documentation_files/libs/quarto-html/quarto.js"></script>
<script src="Documentation_files/libs/quarto-html/popper.min.js"></script>
<script src="Documentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Documentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Documentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Documentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Documentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Documentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Documentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Documentation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="quarterly-data-features" class="level1">
<h1><strong>Quarterly Data Features</strong></h1>
<p>You can obtain quarterly data files from the Food and Drug Administration Adverse Event Reporting System by visiting the website <a href="https://fis.fda.gov/extensions/FPD-QDE-FAERS/FPD-QDE-FAERS.html"><strong>https://fis.fda.gov/extensions/FPD-QDE-FAERS/FPD-QDE-FAERS.html</strong></a>. These files are available in both ASCII and XML formats. For our work, we focus on the ASCII files, which use the “$” character to separate different fields. It’s important to note that neither of these file formats includes all possible data fields. If you need access to all the information, you can make a request through the Freedom of Information Act. When working with the ASCII files, you should refer to the “CASE” field for LAERS ASCII files and the “CASEID” field for FAERS ASCII files.</p>
<p>The data is organized into quarters, representing the four three-month periods of the year: January-March, April-June, July-September, and October-December. The first quarter of the FAERS data is January-March 2004. It’s essential to understand that the quarter refers to the date the report was received by the FDA. Therefore, the FAERS can collect reports about events that occurred before 2004 as well.</p>
<p>Each quarter is further divided into several datasets that contain specific information:</p>
<ul>
<li><p>DEMO: Demographic and administrative information.</p></li>
<li><p>DRUG: Medical products and posology.</p></li>
<li><p>REAC: Adverse events.</p></li>
<li><p>OUTC: Outcomes.</p></li>
<li><p>RPSR: Report sources.</p></li>
<li><p>THER: Temporal information about therapies.</p></li>
<li><p>INDI: Indications.</p></li>
</ul>
<p>The name of each file follows a specific format: &lt;file-descriptor&gt;yyQq. Here, &lt;file-descriptor&gt; represents the four-letter dataset name mentioned earlier, ‘yy’ indicates a two-digit identifier for the year, ‘Q’ is the letter Q, and ‘q’ is a one-digit identifier for the specific quarter. For instance, DEMO12Q4 represents the demographic file for the fourth quarter of 2012.</p>
<p>Each extract includes a set of seven ASCII data files that cover the entire quarter. Starting from 19Q1, each quarter also includes a DELETED file, which contains a list of report identities that should be excluded from the database (the so-called nullified reports). The decision to exclude these reports is made by the FDA or Manufacturers for various reasons, with the aim of aligning the Quarterly Data Extract (QDE) with the public dashboard.</p>
<p>Over time, the data fields have been updated. The conversion from the Legacy Adverse Event Reporting System to the new FDA Adverse Event Reporting System (FAERS) took place in September 2012 (12Q3). To prevent the loss of reports, the first extract of FAERS also includes reports from July 2012.</p>
<p>Data fields have been updated through time, and September 2012 (12Q3) marks the conversion from the Legacy Adverse Event Reporting System to the new&nbsp;FDA Adverse Event Reporting System (FAERS). To avoid the loss of reports, the first extract also includes reports from July 2012.</p>
<p>In the previous LAERS database, the data was based on Individual Safety Reports (ISR), where each ISR represented a separate version of a case (e.g., Initial, Follow-up 1, Follow-up 2, and so on). In contrast, the new FAERS database is case-based, where each case can have one or more versions starting from version 1. Intermediate versions may be missing if multiple updates were reported during the same quarter.</p>
<p>Lastly, it’s important to note that the LAERS data was compiled in uppercase, while the FAERS data is in mixed case.</p>
<p>Further details about data features are provided in the following paragraphs.</p>
<p><img src="images/FAERS_flowchart-01.png" class="img-fluid"></p>
<p><br>
The Entity Relationship Diagram (ERD) of the FAERS illustrates the relationships between different datasets.</p>
<ul>
<li><p>The “primaryid” attribute is used to identify a specific version of a caseid. It serves as the primary key in several datasets.</p></li>
<li><p>DEMO dataset: In the DEMO dataset, there should be only one “primaryid” value, but there can be multiple “caseid”s associated with that “primaryid”.</p></li>
<li><p>REAC, OUTC, RPSR, and DRUG datasets: The “primaryid” attribute serves as the primary key in these datasets. Each dataset can have multiple rows with the same “primaryid” value, indicating multiple reactions, outcomes, report sources, or drugs associated with a particular case.</p></li>
<li><p>THER and INDI datasets: The combination of “primaryid” and “drug_seq” attributes is used to join these datasets with the DRUG dataset. The “primaryid” and “drug_seq” together act as a composite key to establish the relationship between the THER and INDI datasets with the DRUG dataset. This relationship implies that multiple therapies or indications can be associated with a specific drug for a particular case.</p></li>
</ul>
</section>
<section id="cleaning-pipeline" class="level1">
<h1><strong>Cleaning pipeline</strong></h1>
<p>In the following steps, we outline the procedure for cleaning the data. It’s important to note that you don’t need to understand every line of code to obtain a cleaned database. You can simply run the provided script or use the already cleaned database. However, it is crucial to read the accompanying text to comprehend how the pre-processing steps impact the subsequent analyses and interpretation. In the case you want to run the script, please include the script, along with the project, in a folder named “DIANA”.</p>
<p>Please ensure you have an internet connection as the script will download the necessary tools and FAERS quarterly data from the internet.</p>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">1. Set up</h2>
<section id="a.-import-tools" class="level3">
<h3 class="anchored" data-anchor-id="a.-import-tools">a. Import Tools</h3>
<p>To perform the analyses, certain tools are required. R, an open-source software, enables the utilization of packages containing algorithms designed for specific operations. In the process of cleaning the FAERS data, the following libraries are utilized:</p>
<ul>
<li><p>pacman: package to help importing other packages</p></li>
<li><p>tidyverse: A collection of packages (including ggplot2, dplyr, tidyr, and others) that provide a consistent and powerful set of tools for data manipulation, exploration, and visualization.</p></li>
<li><p>data.table: A package that extends the functionality of data frames in R, providing a fast and efficient way to manipulate large datasets.</p></li>
<li><p>janitor: A package that offers functions to clean and tidy messy datasets, facilitating data cleaning tasks.</p></li>
<li><p>foreach: A package that provides a looping construct for iterating over elements in parallel or sequentially. It is often used in combination with other packages for parallel computing, shortening preprocessing time.</p></li>
<li><p>xml2: A package for working with XML files, allowing you to parse, manipulate, and extract information from XML data.</p></li>
<li><p>rvest: A package that enables web scraping in R by providing functions to extract information from HTML web pages.</p></li>
</ul>
<p><img src="images/Diagram.drawio%20(1).svg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up packages-------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"tidyverse"</span>,<span class="st">"data.table"</span>,<span class="st">"janitor"</span>,<span class="st">"foreach"</span>,<span class="st">"xml2"</span>,<span class="st">"rvest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b.-download-faers" class="level3">
<h3 class="anchored" data-anchor-id="b.-download-faers">b. Download FAERS</h3>
<p>We have provided a script that facilitates the automatic download of FAERS quarterly data in ASCII file format from the FDA website. The duration of this step can vary depending on factors such as internet speed and memory capacity. In our tests, the download process took between 1 hour and 25 minutes (with a download speed of 74.4 Mbps) to 2 hours (with a download speed of 8.68 Mbps). However, it is important to note that the actual duration may be shorter or longer, as it can be influenced by individual circumstances.</p>
<p><img src="images/Diagram.drawio%20(2).svg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download FAERS--------------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">500</span>)<span class="co">#increase if it times out because of low wifi power</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>FAERS_url <span class="ot">&lt;-</span> <span class="st">"https://fis.fda.gov/extensions/FPD-QDE-FAERS/FPD-QDE-FAERS.html"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pg <span class="ot">&lt;-</span> <span class="fu">read_html</span>(FAERS_url)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>links_to_QD <span class="ot">&lt;-</span> <span class="fu">html_attr</span>(<span class="fu">html_nodes</span>(pg, <span class="st">"a"</span>), <span class="st">"href"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>links_to_QD <span class="ot">&lt;-</span> links_to_QD[<span class="fu">grepl</span>(<span class="st">".zip"</span>,links_to_QD) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"ascii"</span>, links_to_QD)]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"Raw_FAERS_QD"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> links_to_QD){</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  zip_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"Raw_FAERS_QD"</span>, <span class="fu">basename</span>(file))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(file, zip_name)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".zip"</span>,<span class="st">""</span>,zip_name)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(folder_name)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(zip_name,<span class="at">exdir=</span>folder_name)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(zip_name)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"Raw_FAERS_QD//faers_ascii_2018q1/ascii/DEMO18Q1_new.txt"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Raw_FAERS_QD//faers_ascii_2018q1/ascii/DEMO18Q1.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c.-better-storage" class="level3">
<h3 class="anchored" data-anchor-id="c.-better-storage">c.&nbsp;Better Storage</h3>
<p>Each TXT ASCII file in the dataset has entries separated by a $ sign. To optimize memory usage, we have imported and saved these datasets in the RDS format. This format reduces the amount of memory required and improves the speed of reading and writing files.</p>
<p>During the initial import, we encountered some issues with # signs, single quotes (’), and apostrophes, which caused conflicts during the import process. Additionally, we discovered inconsistencies in the number of fields between the header lines and data lines. This inconsistency was caused by a missing $ sign at the end of the header line, leading to improper data reading.</p>
<p>Furthermore, we manually integrated the files to address the following errors:</p>
<p>In DRUG2011Q2, there was a missing newline at line 322966.</p>
<p>In DRUG2011Q3, there was a missing newline at line 247895.</p>
<p>In DRUG2011Q4, there was a missing newline at line 446737.</p>
<p>With the script, we automatically resolve these errors and conflicts, allowing for a smoother data processing experience.</p>
<p><img src="images/Diagram.drawio%20(3).svg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Improve storage--------------------------------------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>faers_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span><span class="st">"Raw_FAERS_QD/"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">recursive=</span>T,<span class="at">pattern=</span><span class="st">".TXT"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ignore.case =</span> T, <span class="at">full.names =</span> T)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>faers_list <span class="ot">&lt;-</span> faers_list[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"STAT|SIZE"</span>,faers_list)]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"Clean Data"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(faers_list, <span class="st">"Clean Data/faers_list.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="do">## correct for missing newlines</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>correct_problematic_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, old_line) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">file</span>(file_path,<span class="at">open =</span> <span class="st">"r"</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(old_line,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">gsub</span>(<span class="st">"([0-9]+)$"</span>,<span class="st">"SePaRaToR</span><span class="sc">\\</span><span class="st">1"</span>,old_line),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                                lines,<span class="at">fixed=</span>T),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"SePaRaToR"</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLines</span>(lines, <span class="at">con =</span> file_path)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">correct_problematic_file</span>(<span class="st">"Raw_FAERS_QD//aers_ascii_2011q2/ascii/DRUG11Q2.txt"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$7475791"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">correct_problematic_file</span>(<span class="st">"Raw_FAERS_QD//aers_ascii_2011q3/ascii/DRUG11Q3.txt"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">$7652730"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">correct_problematic_file</span>(<span class="st">"Raw_FAERS_QD//aers_ascii_2011q4/ascii/DRUG11Q4.txt"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"021487</span><span class="sc">\\</span><span class="st">$7941354"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="do">## store to rds</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>store_to_rds <span class="ot">&lt;-</span>  <span class="cf">function</span>(f){</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".TXT"</span>,<span class="st">".rds"</span>,f, <span class="at">ignore.case =</span> T)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span> (name)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  cn<span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">readLines</span>(<span class="fu">file</span>(f),<span class="at">n=</span><span class="dv">1</span>),<span class="at">split =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">$"</span>))</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">read.table</span>(f,<span class="at">skip=</span><span class="dv">1</span>,<span class="at">sep=</span><span class="st">"$"</span>, <span class="at">comment.char =</span> <span class="st">""</span>,<span class="at">quote=</span><span class="st">""</span>,<span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> cn</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(x,<span class="at">file=</span>name)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">closeAllConnections</span>()</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(faers_list, store_to_rds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="merge-quarters" class="level2">
<h2 class="anchored" data-anchor-id="merge-quarters">2. Merge quarters</h2>
<p>We initiated the process of merging quarters within each dataframe in the relational database, beginning with the DEMO dataset. We first merged the quarters for the LAERS data and then proceeded with the FAERS data. During this process, we encountered and solved several conflicts:</p>
<ol type="1">
<li><p>names of the variables were not constant, not only between LAERS and FAERS but also among different quarters within FAERS. We standardized them.</p></li>
<li><p>not all the columns were compiled. We removed columns for which values were not provided, mainly because of privacy.</p></li>
<li><p>some columns were duplicated in some quarters, for example due to a misspelling in the column name. We collapsed their values into a unique column.</p></li>
<li><p>the missing of a data could be recorded as either “” or NA. We converted everything to NA.</p></li>
</ol>
<p>To address these conflicts, we built a function and documented the details of merged and excluded variables, providing a step-by-step explanation of the script. Furthermore, we defined a variable with information about the quarter of year in which the drug was received by the FDA.</p>
<p><img src="images/Screenshot%202023-07-18%20at%2012.56.37.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>faers_list <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"Clean Data/faers_list.csv"</span>)<span class="sc">$</span>x</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>unify_data <span class="ot">&lt;-</span> <span class="cf">function</span>(files_list, namekey, column_subset,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                       duplicated_cols_x,duplicated_cols_y) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">f =</span> files_list) <span class="sc">%do%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    {name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".TXT"</span>, <span class="st">".rds"</span>, f, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(name)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(name)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(x))]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    quart <span class="ot">&lt;-</span> <span class="fu">substr</span>(name, <span class="fu">nchar</span>(name) <span class="sc">-</span> <span class="dv">7</span>, <span class="fu">nchar</span>(name) <span class="sc">-</span> <span class="dv">4</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">setDT</span>(x)[, quarter <span class="sc">:</span><span class="er">=</span> quart]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(x) <span class="ot">&lt;-</span> namekey[<span class="fu">names</span>(x)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(y, x), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> x</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(duplicated_cols_x))<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(duplicated_cols_x)){</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      y[<span class="fu">is.na</span>(<span class="fu">get</span>(duplicated_cols_x[n])),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        (duplicated_cols_x[n]) <span class="sc">:</span><span class="er">=</span> <span class="fu">get</span>(duplicated_cols_y[n])]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  removed_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(y),column_subset)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(y)[<span class="fu">colnames</span>(y) <span class="sc">%in%</span> column_subset]</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[, ..cols]</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  y[y <span class="sc">==</span> <span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The following columns were lost in the cleaning: "</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste0</span>(removed_cols,<span class="at">collapse =</span> <span class="st">"; "</span>)))</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="demo" class="level3">
<h3 class="anchored" data-anchor-id="demo">DEMO</h3>
<p>To ensure a cleaner and conflict-free database, the following steps were taken during the merging process for the DEMO dataset:</p>
<ol type="1">
<li><p>Variables “IMAGE,” “CONFID,” and “DEATH_DT” were excluded from the dataset. This was done to adhere to privacy guidelines. In fact, these variables were not even included in the FAERS data.</p></li>
<li><p>The FAERS variable “sex” was derived by combining the “sex” and “gndr_cod” variables.</p></li>
<li><p>The FAERS variable “reporter date” was obtained by combining the “rept_dt” and ” rept_dt” variables.</p></li>
</ol>
<p>In particular we run the function unify_data with the parameters shown in the script below, and then saved the database as an RDS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>DEMO <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(<span class="at">files_list =</span> faers_list[<span class="fu">str_detect</span>(faers_list,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">regex</span>(<span class="st">"demo"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">ignore_case =</span> T))],</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">namekey =</span> <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">CASE=</span><span class="st">"caseid"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FOLL_SEQ=</span><span class="st">"caseversion"</span>,<span class="at">I_F_COD=</span><span class="st">"i_f_cod"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">EVENT_DT=</span><span class="st">"event_dt"</span>,<span class="at">MFR_DT=</span><span class="st">"mfr_dt"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FDA_DT=</span><span class="st">"fda_dt"</span>,<span class="at">REPT_COD=</span><span class="st">"rept_cod"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">MFR_NUM=</span><span class="st">"mfr_num"</span>,<span class="at">MFR_SNDR=</span><span class="st">"mfr_sndr"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">AGE=</span><span class="st">"age"</span>,<span class="at">AGE_COD=</span><span class="st">"age_cod"</span>,<span class="at">GNDR_COD=</span><span class="st">"sex"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">E_SUB=</span><span class="st">"e_sub"</span>,<span class="at">WT=</span><span class="st">"wt"</span>,<span class="at">WT_COD=</span><span class="st">"wt_cod"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">REPT_DT=</span><span class="st">"rept_dt"</span>, <span class="at">OCCP_COD=</span><span class="st">"occp_cod"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">TO_MFR=</span><span class="st">"to_mfr"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">REPORTER_COUNTRY=</span><span class="st">"reporter_country"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">quarter=</span><span class="st">"quarter"</span>,<span class="at">i_f_code=</span><span class="st">"i_f_cod"</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">column_subset =</span> <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"caseid"</span>,<span class="st">"caseversion"</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"i_f_cod"</span>,<span class="st">"sex"</span>,<span class="st">"age"</span>,<span class="st">"age_cod"</span>,<span class="st">"age_grp"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"wt"</span>,<span class="st">"wt_cod"</span>,<span class="st">"reporter_country"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"occr_country"</span>,<span class="st">"event_dt"</span>,<span class="st">"rept_dt"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"mfr_dt"</span>,<span class="st">"init_fda_dt"</span>,<span class="st">"fda_dt"</span>,<span class="st">"rept_cod"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"occp_cod"</span>,<span class="st">"mfr_num"</span>,<span class="st">"mfr_sndr"</span>,<span class="st">"to_mfr"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"e_sub"</span>,<span class="st">"quarter"</span>,<span class="st">"auth_num"</span>,<span class="st">"lit_ref"</span>),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">duplicated_cols_x =</span> <span class="fu">c</span>(<span class="st">"rept_dt"</span> , <span class="st">"sex"</span>),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">duplicated_cols_y =</span> <span class="fu">c</span>(<span class="st">" rept_dt"</span>, <span class="st">"gndr_cod"</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(DEMO,<span class="st">"Clean Data/DEMO.rds"</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(DEMO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Diagram.drawio-4.svg" class="img-fluid"></p>
<p><img src="images/Untitled-7.png" class="img-fluid"></p>
<p><img src="images/Untitled-8.png" class="img-fluid"></p>
<p><img src="images/Untitled-9.png" class="img-fluid"></p>
<p><img src="images/Untitled-10.png" class="img-fluid"></p>
</section>
<section id="drug" class="level3">
<h3 class="anchored" data-anchor-id="drug">DRUG</h3>
<p>To ensure a cleaner and conflict-free database, the following steps were taken during the merging process:</p>
<ol type="1">
<li><p>The FAERS variable “lot num” was derived by combining the “lot num” and “lot_nbr” variables.</p></li>
<li><p>LAERS and FAERS were merged into a new dataset DRUG (including only general information about which drugs and the suspect degree) and a new dataset DRUG_INFO (including details about doses, formulations, dechallenge, and routes). Both these datasets kept the primary (primaryid) and secondary key (drug_seq)</p></li>
</ol>
<p>In particular we run the function unify_data with the parameters shown in the script below, and then saved the database as an RDS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>DRUG <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(<span class="at">files_list =</span> faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"drug"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">namekey =</span> <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">DRUG_SEQ=</span><span class="st">"drug_seq"</span>,<span class="at">ROLE_COD=</span><span class="st">"role_cod"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DRUGNAME=</span><span class="st">"drugname"</span>,<span class="at">VAL_VBM=</span><span class="st">"val_vbm"</span>,<span class="at">ROUTE=</span><span class="st">"route"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DOSE_VBM=</span><span class="st">"dose_vbm"</span>,<span class="at">DECHAL=</span><span class="st">"dechal"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">RECHAL=</span><span class="st">"rechal"</span>,<span class="at">LOT_NUM=</span><span class="st">"lot_num"</span>,<span class="at">NDA_NUM=</span><span class="st">"nda_num"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">EXP_DT=</span><span class="st">"exp_dt"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">column_subset =</span> <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>,<span class="st">"role_cod"</span>,<span class="st">"drugname"</span>,<span class="st">"prod_ai"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">duplicated_cols_x =</span> <span class="cn">NA</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">duplicated_cols_y =</span> <span class="cn">NA</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(DRUG,<span class="st">"Clean Data/DRUG.rds"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(DRUG)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(<span class="at">files_list =</span> faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"drug"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">namekey =</span> <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">DRUG_SEQ=</span><span class="st">"drug_seq"</span>,<span class="at">ROLE_COD=</span><span class="st">"role_cod"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DRUGNAME=</span><span class="st">"drugname"</span>,<span class="at">VAL_VBM=</span><span class="st">"val_vbm"</span>,<span class="at">ROUTE=</span><span class="st">"route"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DOSE_VBM=</span><span class="st">"dose_vbm"</span>,<span class="at">DECHAL=</span><span class="st">"dechal"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">RECHAL=</span><span class="st">"rechal"</span>,<span class="at">LOT_NUM=</span><span class="st">"lot_num"</span>,<span class="at">NDA_NUM=</span><span class="st">"nda_num"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">EXP_DT=</span><span class="st">"exp_dt"</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">column_subset =</span> <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>,<span class="st">"val_vbm"</span>,<span class="st">"nda_num"</span>,<span class="st">"lot_num"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"route"</span>,<span class="st">"dose_form"</span>,<span class="st">"dose_freq"</span>,<span class="st">"exp_dt"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"dose_vbm"</span>,<span class="st">"cum_dose_unit"</span>,<span class="st">"cum_dose_chr"</span>,<span class="st">"dose_amt"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"dose_unit"</span>,<span class="st">"dechal"</span>,<span class="st">"rechal"</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">duplicated_cols_x =</span> <span class="fu">c</span>(<span class="st">"lot_num"</span>),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">duplicated_cols_y =</span> <span class="fu">c</span>(<span class="st">"lot_nbr"</span>))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(DRUG_INFO,<span class="st">"Clean Data/DRUG_INFO.rds"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(DRUG_INFO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The information included in the DRUG database was stored in two different data frames for storage convenience. One with general information (in white) and one with details doses, lot and expiration dates (in blue).</p>
<p><img src="images/Untitled-11.png" class="img-fluid"></p>
<p><img src="images/Untitled-12.png" class="img-fluid"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Untitled-13.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><img src="images/Untitled-14.png" class="img-fluid figure-img"></figcaption><p></p>
</figure>
</div>
</section>
<section id="indi" class="level3">
<h3 class="anchored" data-anchor-id="indi">INDI</h3>
<p>To ensure a cleaner and conflict-free database, we run the function unify_data with the parameters shown in the script below, and then removed rows with no indication specified and saved the database as an RDS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>INDΙ <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"indi"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">DRUG_SEQ=</span><span class="st">"drug_seq"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">indi_drug_seq=</span><span class="st">"drug_seq"</span>,<span class="at">INDI_PT=</span><span class="st">"indi_pt"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>,<span class="st">"indi_pt"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>INDΙ <span class="ot">&lt;-</span> INDΙ[<span class="sc">!</span><span class="fu">is.na</span>(indi_pt)]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(INDΙ,<span class="st">"Clean Data/INDI.rds"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(INDΙ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Untitled-15.png" class="img-fluid"></p>
</section>
<section id="outc" class="level3">
<h3 class="anchored" data-anchor-id="outc">OUTC</h3>
<p>To ensure a cleaner and conflict-free database, we run the function unify_data with the parameters shown in the script below, and then removed rows with no outcome specified and saved the database as an RDS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>OUTC <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"outc"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">OUTC_COD=</span><span class="st">"outc_cod"</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"outc_cod"</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"outc_cod"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"outc_code"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>OUTC <span class="ot">&lt;-</span> OUTC[<span class="sc">!</span><span class="fu">is.na</span>(outc_cod)]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(OUTC,<span class="st">"Clean Data/OUTC.rds"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(OUTC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-25%20at%2009.29.25.png" class="img-fluid"></p>
</section>
<section id="reac" class="level3">
<h3 class="anchored" data-anchor-id="reac">REAC</h3>
<p>To ensure a cleaner and conflict-free database, we run the function unify_data with the parameters shown in the script below, and then removed rows with no reaction specified and saved the database as an RDS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>REAC <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"reac"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>, <span class="at">PT=</span><span class="st">"pt"</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"pt"</span>,<span class="st">"drug_rec_act"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>REAC <span class="ot">&lt;-</span> REAC[<span class="sc">!</span><span class="fu">is.na</span>(pt)]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(REAC,<span class="st">"Clean Data/REAC.rds"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(REAC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-25%20at%2009.30.45.png" class="img-fluid"></p>
</section>
<section id="rpsr" class="level3">
<h3 class="anchored" data-anchor-id="rpsr">RPSR</h3>
<p>To ensure a cleaner and conflict-free database, we run the function unify_data with the parameters shown in the script below, and saved the database as an RDS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>RPSR <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"rpsr"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">RPSR_COD=</span><span class="st">"rpsr_cod"</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"primaryid"</span>, <span class="st">"rpsr_cod"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(RPSR,<span class="st">"Clean Data/RPSR.rds"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(RPSR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-25%20at%2009.30.03.png" class="img-fluid"></p>
</section>
<section id="ther" class="level3">
<h3 class="anchored" data-anchor-id="ther">THER</h3>
<p>To ensure a cleaner and conflict-free database, we run the function unify_data with the parameters shown in the script below, and saved the database as an RDS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>THER <span class="ot">&lt;-</span> <span class="fu">unify_data</span>(faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"ther"</span>,<span class="at">ignore_case =</span> T))],</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">ISR=</span><span class="st">"primaryid"</span>,<span class="at">dsg_drug_seq=</span><span class="st">"drug_seq"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DRUG_SEQ=</span><span class="st">"drug_seq"</span>,<span class="at">START_DT=</span><span class="st">"start_dt"</span>,<span class="at">END_DT=</span><span class="st">"end_dt"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DUR=</span><span class="st">"dur"</span>,<span class="at">DUR_COD=</span><span class="st">"dur_cod"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>,<span class="st">"start_dt"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"end_dt"</span>,<span class="st">"dur"</span>,<span class="st">"dur_cod"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">NA</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(THER,<span class="st">"Clean Data/THER.rds"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(THER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-25%20at%2009.31.13.png" class="img-fluid"></p>
</section>
</section>
<section id="standardization" class="level2">
<h2 class="anchored" data-anchor-id="standardization">3. Standardization</h2>
<p>Standardizing the unstandardized FDA Adverse Event Reporting System (FAERS) holds paramount importance in ensuring data consistency and reliable analysis. The FAERS encompasses numerous fields, and while some are standardized based on established dictionaries, others lack such standardization. This inconsistency can impede data interpretation, hinder comparative studies, and hamper accurate identification of adverse events or drugs. Therefore, the pressing need for standardization arises to enhance data quality, facilitate meaningful insights, and enable robust pharmacovigilance efforts.</p>
<section id="meddra" class="level3">
<h3 class="anchored" data-anchor-id="meddra">MedDRA</h3>
<p>Three fields within the dataset have been codified using the Medical Dictionary for Regulatory Activities (MedDRA) Preferred Terms (PTs). These fields are:</p>
<ol type="1">
<li><p>“pt” - Contains information about suspected reactions.</p></li>
<li><p>“indi_pt” - Provides information about the indication for using the drug.</p></li>
<li><p>“drug_rec_act” - Contains information about the event rechallenged.</p></li>
</ol>
<p>While these fields were expected to be standardized, we have identified certain issues. Not all terms were included in the latest MedDRA version due to various factors, such as the use of older MedDRA versions, the presence of non-UTF characters, the use of Low Level Terms, and occasional misspellings. To address these problems, we have incorporated standardization measures.</p>
<p>Please note that we are unable to provide the MedDRA directly. To access it, you need to download it in English from the MedDRA website, which offers a free subscription for academics. After downloading, you will need to unzip the file using the password provided by the Self Service Application. In the external sources folder, we have shared a file named “pt_fixed” that can be used to standardize the unstandardized PTs. It is important to be aware that despite these efforts, some terms may still not have undergone any standardization.<img src="images/Screenshot%202023-07-18%20at%2015.17.22.png" class="img-fluid"></p>
<p><img src="images/Screenshot%202023-07-18%20at%2015.18.37.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">##MedDRA standardization-------------------------------------------------------</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing MedDRA</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>soc <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/soc.asc"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(soc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"soc_cod"</span>,<span class="st">"soc"</span>,<span class="st">"def"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>soc_hlgt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/soc_hlgt.asc"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(soc_hlgt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"soc_cod"</span>,<span class="st">"hlgt_cod"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>hlgt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/hlgt.asc"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(hlgt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hlgt_cod"</span>,<span class="st">"hlgt"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>hlgt_hlt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/hlgt_hlt.asc"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(hlgt_hlt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hlgt_cod"</span>,<span class="st">"hlt_cod"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>hlt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/hlt.asc"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(hlt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hlt_cod"</span>,<span class="st">"hlt"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>hlt_pt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/hlt_pt.asc"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F)  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(hlt_pt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hlt_cod"</span>,<span class="st">"pt_cod"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/pt.asc"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">4</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pt_cod"</span>,<span class="st">"pt"</span>,<span class="st">"primary_soc_cod"</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>llt <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/MedAscii/llt.asc"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">"$"</span>, <span class="at">header=</span>F) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(llt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"llt_cod"</span>,<span class="st">"llt"</span>,<span class="st">"pt_cod"</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the data</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>meddra <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(<span class="fu">merge</span>(</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  soc, soc_hlgt,<span class="at">all =</span> <span class="cn">TRUE</span>),hlgt, <span class="at">all =</span> <span class="cn">TRUE</span>),hlgt_hlt,<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  hlt, <span class="at">all =</span> <span class="cn">TRUE</span>), hlt_pt, <span class="at">all =</span> <span class="cn">TRUE</span>), pts, <span class="at">all =</span> <span class="cn">TRUE</span>), llt,<span class="at">all=</span><span class="cn">TRUE</span>))</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to lowercase</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>meddra[,(<span class="fu">colnames</span>(meddra))<span class="sc">:</span><span class="er">=</span><span class="fu">lapply</span>(.SD, tolower),]</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the data to CSV files</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(<span class="fu">distinct</span>(meddra[,.(def,soc, hlgt,hlt,pt,llt)]),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Dictionaries/MedDRA/meddra.csv"</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(<span class="fu">distinct</span>(meddra[soc_cod<span class="sc">==</span>primary_soc_cod][,.(def,soc, hlgt,hlt,pt)]),</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Dictionaries/MedDRA/meddra_primary.csv"</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Read PT file and extract unique lowercase PT values</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>pt_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">tolower</span>(<span class="fu">trimws</span>(</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/meddra.csv"</span>))<span class="sc">$</span>pt)))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>manual_fix_file <span class="ot">&lt;-</span> <span class="st">"External Sources/Manual_fix/pt_fixed.csv"</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>standardize_PT <span class="ot">&lt;-</span> <span class="cf">function</span>(data_file, pt_variable) {</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read data file</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(data_file))</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract PTs from data and calculate frequencies</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  pt_freq <span class="ot">&lt;-</span> data[, .(<span class="at">pt =</span> <span class="fu">tolower</span>(<span class="fu">trimws</span>(<span class="fu">get</span>(pt_variable))))][</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(pt)][, .N, by <span class="ot">=</span> <span class="st">"pt"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if PTs are standardized or not</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  pt_freq[, standard_pt <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(pt <span class="sc">%in%</span> pt_list, pt, <span class="cn">NA</span>)]</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  pt_freq[, freq <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)]</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get unstandardized PTs</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  not_pts <span class="ot">&lt;-</span> pt_freq[<span class="fu">is.na</span>(standard_pt)][, .(pt, N, freq)]</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The portion of non standardized PTs at the beginning is "</span>,</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>               <span class="fu">round</span>(<span class="fu">sum</span>(not_pts<span class="sc">$</span>N)<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">nrow</span>(data[<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">get</span>(pt_variable))]),<span class="dv">3</span>)))</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try to translate unstandardized PTs through LLTs</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  llts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(not_pts, <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/meddra.csv"</span>))[</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    , .(<span class="at">standard_pt =</span> pt, <span class="at">pt =</span> llt)])</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  not_llts <span class="ot">&lt;-</span> llts[<span class="fu">is.na</span>(standard_pt)] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>standard_pt)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If still untraslated, use manual integration</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>  pt_fixed <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(manual_fix_file))[, .(pt, standard_pt)]</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  manual <span class="ot">&lt;-</span> <span class="fu">left_join</span>(not_llts, pt_fixed)[<span class="fu">is.na</span>(standard_pt),][, .(pt, standard_pt)]</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine PTs from LLTs, manual integration, and already standardized PTs</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>  pt_fixed <span class="ot">&lt;-</span> <span class="fu">distinct</span>(<span class="fu">rbindlist</span>(<span class="fu">list</span>(pt_fixed, manual, llts[<span class="sc">!</span><span class="fu">is.na</span>(standard_pt), .(pt, standard_pt)])))</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  unstandardized_pts <span class="ot">&lt;-</span> pt_fixed[<span class="fu">is.na</span>(standard_pt)]</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write updated manual fix file</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv2</span>(pt_fixed, manual_fix_file)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="fu">nrow</span>(unstandardized_pts),</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>               <span class="st">" pts are not standardized using LLTs or previously proposed manual fix: "</span>,</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste0</span>(unstandardized_pts<span class="sc">$</span>pt,<span class="at">collapse =</span> <span class="st">"; "</span>),</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>               <span class="st">". Consider updating the pt_fixed.csv file."</span>))</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  pt_fixed <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(manual_fix_file))[, .(<span class="at">pt_temp=</span>pt, standard_pt)]</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update PTs in the data file</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> pt_fixed[data[, pt_temp <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">trimws</span>(<span class="fu">get</span>(pt_variable)))], on <span class="ot">=</span> <span class="st">"pt_temp"</span>][</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    ,pt_temp <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(standard_pt), pt_temp, standard_pt)] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>standard_pt)</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(pt_variable))</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the portion of standardized PTs</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  standardized_percentage <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(data[pt_temp <span class="sc">%in%</span> pt_list]) <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> <span class="fu">nrow</span>(data[<span class="sc">!</span><span class="fu">is.na</span>(pt_temp)]), <span class="dv">3</span>)</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The portion of standardized PTs at the end is "</span>,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>               standardized_percentage))</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(data,<span class="at">old=</span><span class="st">"pt_temp"</span>,<span class="at">new=</span>pt_variable)</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the standardized data and standardized percentage</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> <span class="fu">standardize_PT</span>(<span class="st">"Clean Data/REAC.rds"</span>,<span class="st">"pt"</span>)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="co">#consider updating the pt_fixed file</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Reac,<span class="st">"Clean Data/REAC.rds"</span>)</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> <span class="fu">standardize_PT</span>(<span class="st">"Clean Data/REAC.rds"</span>,<span class="st">"drug_rec_act"</span>)</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="co">#consider updating the pt_fixed file</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Reac,<span class="st">"Clean Data/REAC.rds"</span>)</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>Indi <span class="ot">&lt;-</span> <span class="fu">standardize_PT</span>(<span class="st">"Clean Data/INDI.rds"</span>,<span class="st">"indi_pt"</span>)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a><span class="co">#consider updating the pt_fixed file</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Indi,<span class="st">"Clean Data/INDI.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="drug-1" class="level3">
<h3 class="anchored" data-anchor-id="drug-1">Drug</h3>
<p>The FDA Adverse Event Reporting System (FAERS) receives drug names in various forms, including brand names, active ingredients, abbreviations, and misspellings. This lack of consistency in nomenclature poses significant challenges. The absence of agreed-upon standardization strategies and transparency further exacerbates the problem, leading to issues with replicability and accuracy when conducting disproportionality analysis using FAERS data. To address this, we have developed DIANA_dictionary, a specialized drug standardization dictionary tailored specifically for the FAERS (https://doi.org/10.1101/2023.06.07.23291076). The script provided allows for the utilization of DIANA_dictionary and its integration into each preprocessing cycle, ensuring comprehensive drug standardization. By incorporating this solution, we aim to enhance the reliability and quality of FAERS data analysis, ultimately facilitating more accurate and reproducible results.<img src="images/Screenshot%202023-07-18%20at%2019.11.35.png" class="img-fluid"></p>
<p><img src="images/Screenshot%202023-07-18%20at%2019.12.14.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/DRUG.rds"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>old_DIANA_dictionary <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/DiAna_dictionary/drugnames_standardized.csv"</span>))[</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  ,.(drugname,Substance,Checked,OpenRefine)][Substance<span class="sc">!=</span><span class="st">"na"</span>][<span class="sc">!</span><span class="fu">is.na</span>(Substance)]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span>Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>,<span class="st">" "</span>,<span class="fu">trimws</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.$"</span>,<span class="st">""</span>,<span class="fu">trimws</span>(<span class="fu">tolower</span>(drugname)))))]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">trimws</span>(<span class="fu">gsub</span>(<span class="st">"[^)[:^punct:]]+$"</span>,<span class="st">""</span>,drugname,<span class="at">perl=</span><span class="cn">TRUE</span>))]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">trimws</span>(<span class="fu">gsub</span>(<span class="st">"^[^([:^punct:]]+"</span>,<span class="st">""</span>,drugname,<span class="at">perl=</span><span class="cn">TRUE</span>))]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">trimws</span>(<span class="fu">gsub</span>(<span class="st">"[^)[:^punct:]]+$"</span>,<span class="st">""</span>,drugname,<span class="at">perl=</span><span class="cn">TRUE</span>))]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">trimws</span>(<span class="fu">gsub</span>(<span class="st">"^[^([:^punct:]]+"</span>,<span class="st">""</span>,drugname,<span class="at">perl=</span><span class="cn">TRUE</span>))]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">( "</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">("</span>,drugname)]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,drugname<span class="sc">:</span><span class="er">=</span><span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">)"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">)"</span>,drugname)]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> Drug[,.N,by<span class="ot">=</span><span class="st">"drugname"</span>]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[,freq<span class="sc">:</span><span class="er">=</span><span class="dv">100</span><span class="sc">*</span>N<span class="sc">/</span><span class="fu">sum</span>(temp<span class="sc">$</span>N, <span class="at">na.rm =</span> T)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> old_DIANA_dictionary[temp,on<span class="ot">=</span><span class="st">"drugname"</span>]</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(temp, <span class="st">"External Sources/Dictionaries/DIANA_dictionary/drugnames_standardized.csv"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># consider extending the standardization, inside the drugnames_standardized,</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># before resetting the DIANA_dictionary.</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Our scope is to at least grant a translation for terms occurring more than</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 200 times. For drugs of interest, particularly, the newly marketed ones,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># a more extended translation may be needed for the best case retrieval.</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>DIANA_dictionary <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read.csv2</span>(<span class="st">"External Sources/Dictionaries/DiAna_dictionary/drugnames_standardized.csv"</span>))[</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  ,.(drugname,Substance)][Substance<span class="sc">!=</span><span class="st">"na"</span>][<span class="sc">!</span><span class="fu">is.na</span>(Substance)]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> DIANA_dictionary[Drug,on<span class="ot">=</span><span class="st">"drugname"</span>]</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>Drug_multi <span class="ot">&lt;-</span> Drug[<span class="fu">grepl</span>(<span class="st">";"</span>,Substance)] </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>,<span class="st">"Substance"</span>,<span class="st">"role_cod"</span>,<span class="st">"drugname"</span>,<span class="st">"prod_ai"</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>Drug_multi <span class="ot">&lt;-</span> Drug_multi[, <span class="fu">strsplit</span>(Substance, <span class="st">";"</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>), by <span class="ot">=</span> cn]</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>Drug_multi <span class="ot">&lt;-</span> Drug_multi[,.(primaryid,drug_seq,<span class="at">Substance=</span>V1,role_cod,drugname,prod_ai)]</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>Drug_one <span class="ot">&lt;-</span> Drug[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">";"</span>,Substance)] </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>Drug_one <span class="ot">&lt;-</span> Drug_one[,.(primaryid,drug_seq,Substance,role_cod,drugname,prod_ai)]</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(Drug_multi,Drug_one))</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,trial<span class="sc">:</span><span class="er">=</span><span class="fu">grepl</span>(<span class="st">", trial"</span>,Substance)]</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(Drug[trial<span class="sc">==</span><span class="cn">TRUE</span>])</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,Substance<span class="sc">:</span><span class="er">=</span><span class="fu">gsub</span>(<span class="st">", trial"</span>,<span class="st">""</span>,Substance)]</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>Drug<span class="sc">$</span>drugname <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Drug<span class="sc">$</span>drugname)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>Drug<span class="sc">$</span>prod_ai <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Drug<span class="sc">$</span>prod_ai)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>Drug<span class="sc">$</span>Substance <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Drug<span class="sc">$</span>Substance)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Drug,<span class="st">"Clean Data/DRUG.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sex" class="level3">
<h3 class="anchored" data-anchor-id="sex">Sex</h3>
<p>Within the ASCII Sex field, according to the ASC_NTS.pdf guidelines, entries should only consist of “F” (Female), “M” (Male), and “UNK” (Unknown). However, during our analysis, we discovered additional entries that deviated from these expected values. These included “NS” (possibly resembling NAs), “YR” (likely a compilation error), as well as “P,” “I,” and “T” reported consistently throughout the entire year of 2019 in the United States by the mfr_sndr FDA-CTU. To maintain data consistency, we made the decision to retain only the “F” and “M” entries, while converting all other values to “NA” to denote missing or invalid data. By implementing this approach, we ensure adherence to the intended standards and enhance the accuracy and reliability of the dataset, at the potential cost of losing some non-codified information.<img src="images/Screenshot%202023-07-19%20at%2011.09.30.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/DEMO.rds"</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Demo[,.N,by<span class="ot">=</span><span class="st">"sex"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Demo[<span class="sc">!</span>sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"F"</span>,<span class="st">"M"</span>)]<span class="sc">$</span>sex<span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-18%20at%2016.25.24.png" class="img-fluid" width="110"></p>
</section>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age">Age</h3>
<p>Regarding age, we have three fields that can be compiled: “age” (numeric value), “age_cod” (age unit: YR for years, MON for months, WK for weeks, DY for days, HR for hours), and “age_group” (age category).</p>
<p>To standardize the age data, we first divided it into two columns: one for age in days and another for age in years. This involved using the numeric age value and appropriately adjusting it according to the specified unit. During this process, we encountered a few reports with “age_cod” entries of “MIN” (interpreted as minutes) and “SEC” (interpreted as seconds), as well as one report with the value “85” (which was converted to NA). Instances marked as NA were considered as years.</p>
<p>We applied specific transformations using the “abs(as.numeric)” function:</p>
<ul>
<li><p>Converted character values (such as “U,” “FEW,” “CUBIST PHARMACEUTICALS, INC.”) to NA.</p></li>
<li><p>Converted “-08” to “8.”</p></li>
<li><p>Removed spaces before or after numbers to convert them correctly.</p></li>
<li><p>Converted negative numbers to positive values.</p></li>
</ul>
<p>If an age expressed in decimals exceeded the upper threshold of 122 (which is the oldest documented human age), it was converted to the same age but in years.</p>
<p>Ages exceeding the threshold of 122 were converted to NA.</p>
<p><img src="images/Screenshot%202023-07-19%20at%2016.18.58.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Demo[,.N,by<span class="ot">=</span><span class="st">"age_cod"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>Demo[,age_corrector<span class="sc">:</span><span class="er">=</span><span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"DEC"</span>,<span class="dv">3650</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"YR"</span><span class="sc">|</span><span class="fu">is.na</span>(age_cod),<span class="dv">365</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"MON"</span>,<span class="fl">30.41667</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"WK"</span>,<span class="dv">7</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                                 <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"DY"</span>,<span class="dv">1</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                                        <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"HR"</span>,<span class="fl">0.04166667</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">ifelse</span>(age_cod<span class="sc">==</span><span class="st">"SEC"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="fl">1.157407e-05</span>,<span class="cn">NA</span>)))))))]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[,age_in_days<span class="sc">:</span><span class="er">=</span><span class="fu">round</span>(<span class="fu">abs</span>(<span class="fu">as.numeric</span>(age))<span class="sc">*</span>age_corrector)]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Demo<span class="sc">$</span>age_in_days)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>Demo[,age_in_days<span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(age_in_days<span class="sc">&lt;=</span><span class="dv">122</span><span class="sc">*</span><span class="dv">365</span>,age_in_days,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span> (age_cod<span class="sc">==</span><span class="st">"DEC"</span>,age_in_days<span class="sc">/</span>age_corrector,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">NA</span>))]<span class="co">#plausible compilation error</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[,age_in_years<span class="sc">:</span><span class="er">=</span><span class="fu">round</span>(age_in_days<span class="sc">/</span><span class="dv">365</span>)]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Demo<span class="sc">$</span>age_in_years, <span class="at">xlab =</span> <span class="st">"Age (years old)"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Demo<span class="sc">$</span>age_in_years)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>age_corrector,<span class="sc">-</span>age,<span class="sc">-</span>age_cod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-18%20at%2016.29.52.png" class="img-fluid" width="112"></p>
<p><img src="images/Screenshot%202023-07-18%20at%2017.15.50.png" class="img-fluid"></p>
<p>The age and age_grp were not always congruous.</p>
<p>We reestimated the age groups considering the thresholds given by the NIH style guide (ref:&nbsp;<a href="https://www.nih.gov/nih-style-guide/age" class="uri">https://www.nih.gov/nih-style-guide/age</a>):</p>
<ul>
<li><p>neonates ≤28dd</p></li>
<li><p>infants &lt; 1yy</p></li>
<li><p>child &lt;13yy</p></li>
<li><p>teenager &lt; 18yy</p></li>
<li><p>adult &lt; 65yy</p></li>
<li><p>elderly ≥65yy</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> Demo[<span class="sc">!</span><span class="fu">is.na</span>(age_grp) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(age_in_years),.N,by<span class="ot">=</span><span class="fu">c</span>(<span class="st">"age_in_years"</span>,<span class="st">"age_grp"</span>)]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>temp[age_grp<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"N"</span>,<span class="st">"I"</span>)]<span class="sc">$</span>age_grp <span class="ot">&lt;-</span> <span class="st">"N&amp;I"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>age_grp <span class="ot">&lt;-</span> <span class="fu">factor</span>(temp<span class="sc">$</span>age_grp,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N&amp;I"</span>,<span class="st">"C"</span>,<span class="st">"T"</span>,<span class="st">"A"</span>,<span class="st">"E"</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>Age_thresholds <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>age_group , <span class="sc">~</span>age_threshold,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----------|----------------|</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"C"</span>        , <span class="dv">2</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T"</span>        , <span class="dv">12</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"A"</span>        , <span class="dv">18</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"E"</span>        , <span class="dv">65</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>temp) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>age_in_years,<span class="at">y=</span>N,<span class="at">group=</span>age_grp,<span class="at">fill=</span>age_grp,<span class="at">color=</span>age_grp), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>age_in_years,<span class="at">y=</span>N,<span class="at">group=</span>age_grp,<span class="at">fill=</span>age_grp,<span class="at">color=</span>age_grp),<span class="at">stat=</span><span class="st">"identity"</span>,<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Age_thresholds,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>age_threshold,<span class="at">y=</span><span class="dv">0</span>),<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> Age_thresholds,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>age_threshold,<span class="at">y=</span><span class="dv">0</span>,<span class="at">label=</span>age_threshold), <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">500</span>,<span class="at">angle=</span><span class="dv">45</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age (yr)"</span>) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Freq"</span>) <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()<span class="sc">+</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Age Group"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Neonate&amp;Infant"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Child"</span>,<span class="st">"Teenager"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"Adult"</span>,<span class="st">"Elderly"</span>))</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>Demo<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>Demo[<span class="sc">!</span><span class="fu">is.na</span>(age_in_years)]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"E"</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>Demo[age_in_years <span class="sc">&lt;</span> <span class="dv">65</span>]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"A"</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>Demo[age_in_years <span class="sc">&lt;</span> <span class="dv">18</span>]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"T"</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>Demo[age_in_years <span class="sc">&lt;</span> <span class="dv">12</span>]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"C"</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>Demo[age_in_years <span class="sc">&lt;</span> <span class="dv">2</span>]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"I"</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>Demo[age_in_days <span class="sc">&lt;</span><span class="dv">28</span>]<span class="sc">$</span>age_grp_st <span class="ot">&lt;-</span> <span class="st">"N"</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>Demo[,.N,by<span class="ot">=</span><span class="st">"age_grp_st"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)][,perc<span class="sc">:</span><span class="er">=</span><span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N)<span class="sc">*</span><span class="dv">100</span>),]</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>age_grp) <span class="sc">%&gt;%</span> <span class="fu">rename</span> (<span class="at">age_grp=</span>age_grp_st)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot%202023-07-18%20at%2017.28.00.png" class="img-fluid"></p>
</section>
<section id="weight" class="level3">
<h3 class="anchored" data-anchor-id="weight">Weight</h3>
<p>Next, we proceeded to extract the weight units utilized in the database. However, we encountered some inconsistencies within this field. To address this, we decided to focus solely on the three units explicitly mentioned in the ASC.NTS.pdf guidelines:</p>
<ol type="1">
<li><p>KG - Kilograms</p></li>
<li><p>LBS - Pounds</p></li>
<li><p>GMS - Grams</p></li>
</ol>
<p>Additionally, we included “KGS” as an alternative representation for kilograms.</p>
<p>Any missing values (NAs) were considered as kilograms (KG) for consistency.</p>
<p>To ensure uniformity and accuracy, we made the following transformations:</p>
<ol type="1">
<li><p>We translated weight values into positive numbers. Certain characters, such as “U,” “M,” and “S,” were lost during this process.</p></li>
<li><p>Examples like “82.3KG” were translated to “82.3” for improved clarity and standardization.</p></li>
</ol>
<p>Furthermore, weights exceeding the heaviest human weight ever documented (635 kg) were considered as NA, indicating missing or invalid data. This approach helps maintain data integrity and reliability during subsequent analyses.</p>
<p><img src="images/Screenshot%202023-07-19%20at%2014.54.24.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Demo[,.N,by<span class="ot">=</span><span class="st">"wt_cod"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Demo<span class="sc">$</span>wt_corrector  <span class="ot">&lt;-</span>  <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Demo[wt_cod<span class="sc">==</span><span class="st">"LBS"</span>]<span class="sc">$</span>wt_corrector   <span class="ot">&lt;-</span>  <span class="fl">0.453592</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>Demo[wt_cod<span class="sc">==</span><span class="st">"KG"</span>]<span class="sc">$</span>wt_corrector  <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Demo[wt_cod<span class="sc">==</span><span class="st">"GMS"</span>]<span class="sc">$</span>wt_corrector  <span class="ot">&lt;-</span>  <span class="fl">0.001</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Demo[<span class="fu">is.na</span>(wt_cod)]<span class="sc">$</span>wt_corrector  <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[,wt_in_kgs<span class="sc">:</span><span class="er">=</span><span class="fu">round</span>(<span class="fu">abs</span>(<span class="fu">as.numeric</span>(wt))<span class="sc">*</span>wt_corrector)]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>Demo[wt_in_kgs<span class="sc">&gt;</span><span class="dv">635</span>]<span class="sc">$</span>wt_in_kgs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> Demo[,.N,by<span class="ot">=</span><span class="st">"wt_in_kgs"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>temp) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>wt_in_kgs,<span class="at">y=</span>N))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>wt_corrector,<span class="sc">-</span>wt,<span class="sc">-</span>wt_cod)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"><img src="images/Screenshot%202023-07-18%20at%2018.33.28.png" class="img-fluid"></h3>
</section>
<section id="country" class="level3">
<h3 class="anchored" data-anchor-id="country">Country</h3>
<p>There are two variables with information about the country: “occur-country” with information about where the event occurred, and “rept-country” with information about from where the report was submitted. The ISO country names were manually integrated to translate “occur-country” and “rept-country” using country ISO codes. Instances where the codes were not specified or were labeled as “COUNTRY NOT SPECIFIED” and “A1” were translated as NA. Additionally, certain codes were translated to the corresponding continent name (e.g., Europe XE, Oceania QU).<img src="images/Screenshot%202023-07-20%20at%2011.56.04.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Countries <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_delim</span>(<span class="st">"External Sources/Manual_fix/countries.csv"</span>,<span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Countries[<span class="fu">is.na</span>(Countries<span class="sc">$</span>country)]<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="st">"NA"</span> <span class="co">#to avoid losing Namibia</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Countries[<span class="fu">union</span>(Demo<span class="sc">$</span>occr_country,Demo<span class="sc">$</span>reporter_country),on<span class="ot">=</span><span class="st">"country"</span>][<span class="fu">is.na</span>(Country_Name)] <span class="co">#check if new not translated</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Countries[,.(country,<span class="at">occr_country=</span>Country_Name)][Demo[,country<span class="sc">:</span><span class="er">=</span>occr_country] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>occr_country),on<span class="ot">=</span><span class="st">"country"</span>] </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Countries[,.(country,<span class="at">reporter_country=</span>Country_Name)][Demo[,country<span class="sc">:</span><span class="er">=</span>reporter_country]<span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>reporter_country),on<span class="ot">=</span><span class="st">"country"</span>] </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="occupation" class="level3">
<h3 class="anchored" data-anchor-id="occupation">Occupation</h3>
<p>Occupation codes, with information about the reporter, were standardized in MD (medical doctor), CN (consumer), OT (other), PH (pharmacist), HP (health pratictioner), LW (lawyer), and RN (registered nurse).</p>
<p>Other values were transformed to NA. In 23Q1 are present 11 reports from SALES, and1 from 20120210 (probably error in compilation). They were transformed in NA.</p>
<p><img src="images/Screenshot%202023-07-19%20at%2014.57.00.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Demo[,.N,by<span class="ot">=</span><span class="st">"occp_cod"</span>][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Demo[<span class="sc">!</span>occp_cod<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"MD"</span>,<span class="st">"CN"</span>,<span class="st">"OT"</span>,<span class="st">"PH"</span>,<span class="st">"HP"</span>,<span class="st">"LW"</span>, <span class="st">"RN"</span>)]<span class="sc">$</span>occp_cod <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dates-and-duration-standardization" class="level3">
<h3 class="anchored" data-anchor-id="dates-and-duration-standardization">Dates and duration standardization</h3>
<p>The script deals with date information in two datasets, Demo and Ther, each containing 5 and 2 date-related columns, respectively. Its primary objective is to standardize the date formats and handle incomplete or inaccurate date entries.</p>
<p>In the process, the script replaces invalid dates with NA values. Dates prior to 1985 and dates beyond the last day of the last quarter (max_date) are considered invalid and converted to NA. Additionally, the script retains only dates with 4, 6, and 8 characters, corresponding to the formats “yyyy,” “yyyymm,” and “yyyymmdd,” respectively.</p>
<p>To preserve information about years when only the year is available, the dates are kept as integers. This approach prevents the auto-completion of incomplete dates to January 1st or the first day of the specified month, ensuring data integrity.</p>
<p>However, it’s essential to be cautious when analyzing time trends. Dates before 2012 were automatically completed by the FDA during storage, potentially leading to inaccuracies in time trend analysis and time-to-onset calculations.</p>
<p>Ther dataset includes two variables related to the duration of pharmacological therapy, one indicating the unit and the other the number. The script converts all duration values to days. In cases where the unit is not provided (NA), some information might be lost, as different measurement units could have been used. The script performs two parallel approaches for standardizing duration. First, it uses the FDA-provided duration when available, but interestingly, this was found to be provided in only about 8% of the rows. Second, for approximately 32% of the rows, the script calculates the duration as the difference between the end date and the start date, adding 1 to the result. In around 1.7% of the total rows, some differences were found between the calculated duration and the FDA-provided duration. These differences were primarily due to rounding to the day, with the FDA sometimes providing a duration starting from 0 days instead of 1.</p>
<p>In handling these differences, the script prioritizes the calculated duration when available, and if not, it fills the duration using the FDA-provided value.</p>
<p>Finally, the duration is used to impute missing start_dt or end_dt values when possible, completing the process of standardizing dates and durations in the datasets.<img src="images/Diagram.drawio%20(6).svg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#please change according to the last quarter</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>max_date <span class="ot">&lt;-</span> <span class="dv">20230331</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/DEMO.rds"</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>check_date <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nchar</span>(dt)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  invalid_dates <span class="ot">&lt;-</span> (n <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">1985</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">4</span>)))) <span class="sc">|</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    (n <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">198500</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">6</span>)))) <span class="sc">|</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    (n <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">19850000</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">8</span>)))) <span class="sc">|</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    (<span class="sc">!</span>n <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  dt[invalid_dates] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>date_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fda_dt"</span>, <span class="st">"rept_dt"</span>, <span class="st">"mfr_dt"</span>, <span class="st">"init_fda_dt"</span>, <span class="st">"event_dt"</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> date_columns) {</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  Demo[, n <span class="sc">:</span><span class="er">=</span> <span class="fu">nchar</span>(.SD[[col]])]</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  Demo[, (col) <span class="sc">:</span><span class="er">=</span> <span class="fu">check_date</span>(.SD[[col]])]</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo, <span class="st">"Clean Data/DEMO.rds"</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/THER.rds"</span>))</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"start_dt"</span>, <span class="st">"end_dt"</span>)) {</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  Ther[, n <span class="sc">:</span><span class="er">=</span> <span class="fu">nchar</span>(.SD[[col]])]</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  Ther[, (col) <span class="sc">:</span><span class="er">=</span> <span class="fu">check_date</span>(.SD[[col]])]</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>Ther<span class="sc">$</span>dur <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Ther<span class="sc">$</span>dur)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>Ther<span class="sc">$</span>dur_corrector <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"YR"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="dv">365</span>]</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>Ther[<span class="fu">is.na</span>(dur_cod), dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"MON"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="fl">30.41667</span>]</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"WK"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="dv">7</span>]</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"DAY"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span>]</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"HR"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="fl">0.04166667</span>]</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"MIN"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="fl">0.0006944444</span>]</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>Ther[dur_cod <span class="sc">==</span> <span class="st">"SEC"</span>, dur_corrector <span class="sc">:</span><span class="er">=</span> <span class="fl">1.157407e-05</span>]</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[, dur_in_days <span class="sc">:</span><span class="er">=</span> <span class="fu">abs</span>(dur) <span class="sc">*</span> dur_corrector][, dur_in_days <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(dur_in_days <span class="sc">&gt;</span> <span class="dv">50</span><span class="sc">*</span><span class="dv">365</span>, <span class="cn">NA</span>, dur_in_days)]</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[, dur_std <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(end_dt) <span class="sc">==</span> <span class="dv">8</span>, <span class="fu">ymd</span>(end_dt), <span class="cn">NA</span>) <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(start_dt) <span class="sc">==</span> <span class="dv">8</span>, <span class="fu">ymd</span>(start_dt), <span class="cn">NA</span>) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[, dur_std <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(dur_std <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, dur_std)][, dur_std <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(dur_std), dur_in_days, dur_std)]</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[,start_dt<span class="sc">:</span><span class="er">=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_dt),</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>                               start_dt,</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(end_dt)<span class="sc">&amp;!</span><span class="fu">is.na</span>(dur_std),</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"-"</span>,<span class="st">""</span>,<span class="fu">as.character</span>(<span class="fu">ymd</span>(end_dt)<span class="sc">-</span>dur_std<span class="sc">+</span><span class="dv">1</span>))),</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>                                      <span class="cn">NA</span>))]</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[,end_dt<span class="sc">:</span><span class="er">=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(end_dt),</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>                             end_dt,</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_dt)<span class="sc">&amp;!</span><span class="fu">is.na</span>(dur_std),</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"-"</span>,<span class="st">""</span>,<span class="fu">as.character</span>(<span class="fu">ymd</span>(start_dt)<span class="sc">+</span>dur_std<span class="dv">-1</span>))),</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>                                    <span class="cn">NA</span>))]</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[,dur_in_days<span class="sc">:</span><span class="er">=</span>dur_std] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>n,<span class="sc">-</span>dur_std, <span class="sc">-</span>dur_corrector, <span class="sc">-</span>dur, <span class="sc">-</span>dur_cod)</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Ther, <span class="st">"Clean Data/THER.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="time-to-onset-calculation" class="level3">
<h3 class="anchored" data-anchor-id="time-to-onset-calculation">Time to onset calculation</h3>
<p>In addition to standardizing dates and durations, the script computes the time to onset for each row in the Ther dataset (see flowchart above). This calculation represents the time delay between the first drug administration (start_dt from Ther) and the occurrence of the corresponding event (event_dt from Demo).</p>
<p>It’s worth noting that while each drug taken by a patient has a specific start_dt, there is only one event_dt recorded per report, even if multiple events are documented. The time to onset is calculated starting from a value of 1, representing the first day of drug administration until the event’s manifestation.</p>
<p>This process allows for further analysis of the time it takes for events to occur after the administration of a particular drug, providing valuable insights into potential correlations or patterns.</p>
<p>In fact, 21% of the time to onset thus calculated are negative which, if true, would exclude causality. 39% of these were submitted before 2013, when dates where autocompleted and are therefore less accurate (45% ended with 01; role_cod 20% PS, 41% SS, 39% C). To take into account the problem of autocompletion we replaced all the dates ending with 01 before 2013 with NA.</p>
<p>For those after 2013, according to the FAERS README, autocompletion was not a problem anymore (19% ended with 01; role_cod 6% PS, 54% SS, and 40% C). In most of these cases the SS was the same active ingredient recorded in the PS, but started some days later the event, only sometimes at a different dose. It should therefore not be a problem for report-based disproportionality analyses, but only for the drug-event pair-based disproportionality analyses (which is anyway obsolete because of other problems as well). We suggest, in any case, to perform at least one analysis excluding, along with concomitants, all the drugs with a negative or null time to onset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Demo[, .(primaryid, event_dt)][<span class="sc">!</span><span class="fu">is.na</span>(event_dt)][Ther, on <span class="ot">=</span> <span class="st">"primaryid"</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[, time_to_onset <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(event_dt) <span class="sc">==</span> <span class="dv">8</span>, <span class="fu">ymd</span>(event_dt), <span class="cn">NA</span>) <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(start_dt) <span class="sc">==</span><span class="dv">8</span>, <span class="fu">ymd</span>(start_dt), <span class="cn">NA</span>) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[, time_to_onset <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(time_to_onset) <span class="sc">|</span> ( time_to_onset<span class="sc">&lt;=</span><span class="dv">0</span> <span class="sc">&amp;</span> event_dt<span class="sc">&lt;=</span><span class="dv">20121231</span>), <span class="cn">NA</span>, time_to_onset)]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Ther, <span class="st">"Clean Data/THER.rds"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="therapy-regimen-standardization" class="level3">
<h3 class="anchored" data-anchor-id="therapy-regimen-standardization">Therapy regimen standardization</h3>
<p>Information about therapy regimen, even if often neglected, requires a thorough standardization. Since most of this information is entered as free text, we have implemented our dictionaries (updated at each quarter) to standardize these fields.</p>
<p>This way we standardize the route of administration, information about dechallenge and rechallenge, information about formulation and frequency of administration. Often the information provided was ambiguous, and this standardization will need further refinement.</p>
<p>Information about doses needs a drug-specific standardization, since information about it is stored in multiple fields, and the unit is often dose-formulation. Information about lot number and nda number is also kept as it is (and in the future may help to impute other fields). The expiration date was cleaned as the other dates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/DRUG_INFO.rds"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> DRUG_INFO[,route<span class="sc">:</span><span class="er">=</span><span class="fu">tolower</span>(<span class="fu">trimws</span>(route)),]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>route_st <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_delim</span>(<span class="st">"External Sources/Manual_fix/route_st.csv"</span>,<span class="st">";"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>))[</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                               ,.(route,route_st)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> route_st[DRUG_INFO,on<span class="ot">=</span><span class="st">"route"</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>route_st <span class="ot">&lt;-</span> DRUG_INFO[,.N,by<span class="ot">=</span><span class="fu">c</span>(<span class="st">"route"</span>,<span class="st">"route_st"</span>)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(route_st,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Manual_fix/route_st.csv"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The following terms are translated to NA: "</span>,<span class="fu">paste0</span>(route_st[</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(route_st)]<span class="sc">$</span>route,<span class="at">collapse=</span><span class="st">"; "</span>), <span class="st">". Integrate NAs and repeat."</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>dechal[<span class="sc">!</span>DRUG_INFO<span class="sc">$</span>dechal <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"N"</span>,<span class="st">"D"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>dechal <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DRUG_INFO<span class="sc">$</span>dechal)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>rechal[<span class="sc">!</span>DRUG_INFO<span class="sc">$</span>rechal <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"N"</span>,<span class="st">"D"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>rechal <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DRUG_INFO<span class="sc">$</span>rechal)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>dose_form <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">trimws</span>(DRUG_INFO<span class="sc">$</span>dose_form))</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>dose_form_st <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_delim</span>(<span class="st">"External Sources/Manual_fix/dose_form_st.csv"</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>))[</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                                   ,.(dose_form,dose_form_st)]</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> dose_form_st[DRUG_INFO,on<span class="ot">=</span><span class="st">"dose_form"</span>]</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>dose_form_st <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DRUG_INFO<span class="sc">$</span>dose_form_st)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>dose_form_st <span class="ot">&lt;-</span> DRUG_INFO[,.N,by<span class="ot">=</span><span class="fu">c</span>(<span class="st">"dose_form"</span>,<span class="st">"dose_form_st"</span>)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(dose_form_st,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Manual_fix/dose_form_st.csv"</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The following terms are translated to NA: "</span>,<span class="fu">paste0</span>(dose_form_st[</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(dose_form_st)]<span class="sc">$</span>dose_form,<span class="at">collapse=</span><span class="st">"; "</span>), <span class="st">". Integrate NAs and repeat."</span>))</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>dose_freq <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_delim</span>(<span class="st">"External Sources/Manual_fix/dose_freq_st.csv"</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                              <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>))[</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>                                ,.(dose_freq,dose_freq_st)][<span class="sc">!</span><span class="fu">is.na</span>(dose_freq_st)] <span class="sc">%&gt;%</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span>  DRUG_INFO <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>route,<span class="sc">-</span>dose_form)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> dose_freq[DRUG_INFO,on<span class="ot">=</span><span class="st">"dose_freq"</span>]</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>dose_freq_st <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DRUG_INFO<span class="sc">$</span>dose_freq_st)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>dose_freq_st <span class="ot">&lt;-</span> DRUG_INFO[,.N,by<span class="ot">=</span><span class="fu">c</span>(<span class="st">"dose_freq"</span>,<span class="st">"dose_freq_st"</span>)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(dose_freq_st,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Manual_fix/dose_freq_st.csv"</span>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"The following terms are translated to NA: "</span>,<span class="fu">paste0</span>(dose_freq_st[</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(dose_freq_st)]<span class="sc">$</span>dose_freq,<span class="at">collapse=</span><span class="st">"; "</span>), <span class="st">". Integrate NAs and repeat."</span>))</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>route_form_st <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_delim</span>(<span class="st">"External Sources/Manual_fix/route_form_st.csv"</span>,<span class="st">";"</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                               <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>))[</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>                                 ,.(dose_form_st,route_plus)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> route_form_st[DRUG_INFO,on<span class="ot">=</span><span class="st">"dose_form_st"</span>]</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>route_form_st <span class="ot">&lt;-</span> DRUG_INFO[,.N,by<span class="ot">=</span><span class="fu">c</span>(<span class="st">"dose_form_st"</span>,<span class="st">"route_st"</span>,<span class="st">"route_plus"</span>)][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(route_form_st,</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>           <span class="st">"External Sources/Manual_fix/route_form_st.csv"</span>)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>route_st <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(DRUG_INFO<span class="sc">$</span>route_st)<span class="sc">|</span>DRUG_INFO<span class="sc">$</span>route_st<span class="sc">==</span><span class="st">"unknown"</span>,</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>                             DRUG_INFO<span class="sc">$</span>route_plus,DRUG_INFO<span class="sc">$</span>route_st)</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>DRUG_INFO<span class="sc">$</span>route_st <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(DRUG_INFO<span class="sc">$</span>route_st)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>DRUG_INFO <span class="ot">&lt;-</span> DRUG_INFO[,.(primaryid,drug_seq,val_vbm,<span class="at">route=</span>route_st,dose_vbm,cum_dose_unit,cum_dose_chr, dose_amt,dose_unit,<span class="at">dose_form=</span>dose_form_st,<span class="at">dose_freq=</span>dose_freq_st,dechal,rechal,lot_num,nda_num,exp_dt)]</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>check_date <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nchar</span>(dt)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>  invalid_dates <span class="ot">&lt;-</span> (n <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">1985</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">4</span>)))) <span class="sc">|</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>    (n <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">198500</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">6</span>)))) <span class="sc">|</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>    (n <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span> (dt <span class="sc">&lt;</span><span class="dv">19850000</span><span class="sc">|</span>dt <span class="sc">&gt;</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(max_date, <span class="dv">0</span>,<span class="dv">8</span>)))) <span class="sc">|</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    (<span class="sc">!</span>n <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>))</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>  dt[invalid_dates] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>max_date <span class="ot">&lt;-</span> <span class="dv">20500101</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"exp_dt"</span>)) {</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  DRUG_INFO[, n <span class="sc">:</span><span class="er">=</span> <span class="fu">nchar</span>(.SD[[col]])]</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>  DRUG_INFO[, (col) <span class="sc">:</span><span class="er">=</span> <span class="fu">check_date</span>(.SD[[col]])]</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(DRUG_INFO,<span class="st">"Clean Data/DRUG_INFO.rds"</span>)</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="remove-nullified-reports" class="level2">
<h2 class="anchored" data-anchor-id="remove-nullified-reports">6. Remove nullified reports</h2>
<p>Starting from 19Q1, each quarter will include a DELETED file, which contains a list of report identities (caseid) that are meant to be excluded from the database based on directives from the FDA or Manufacturers. These exclusions are made for various reasons, such as combining cases, and are intended to align the quarterly data extract with the information displayed on the public dashboard. Depending on the specific date of the data extract and when the deletion took place, these reports may or may not be visible in the quarterly data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>faers_list <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"Clean Data/faers_list.csv"</span>)<span class="sc">$</span>x</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/DEMO.rds"</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Deleted <span class="ot">&lt;-</span> faers_list[<span class="fu">str_detect</span>(faers_list,<span class="fu">regex</span>(<span class="st">"deleted"</span>,<span class="at">ignore_case =</span> T))]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (f <span class="cf">in</span> Deleted){</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".txt"</span>,<span class="st">".rds"</span>,f)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">read.table</span>(f,<span class="at">skip=</span><span class="dv">1</span>,<span class="at">sep=</span><span class="st">"$"</span>,<span class="at">header =</span> F, <span class="at">comment.char =</span> <span class="st">""</span>,<span class="at">quote=</span><span class="st">""</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="st">"caseid"</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">&gt;</span><span class="dv">0</span>){DELETED <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(DELETED,x))}<span class="cf">else</span>{DELETED <span class="ot">&lt;-</span> x}</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>DELETED <span class="ot">&lt;-</span> DELETED <span class="sc">%&gt;%</span>  <span class="fu">distinct</span>()</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[<span class="sc">!</span>caseid <span class="sc">%in%</span>DELETED<span class="sc">$</span>caseid]</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-duplicated-primaryids" class="level2">
<h2 class="anchored" data-anchor-id="remove-duplicated-primaryids">7. Remove duplicated primaryids</h2>
<p>Next, we conducted an analysis of duplicated primaryids, and during this process, we observed that they only differed in the quarter field and caseid. We retained the entry with the most recent quarter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicated primaryid</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[Demo[,.I[quarter<span class="sc">==</span><span class="fu">last</span>(quarter)],by<span class="ot">=</span>primaryid]<span class="sc">$</span>V1]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="flattening-of-case-versions" class="level2">
<h2 class="anchored" data-anchor-id="flattening-of-case-versions">8. Flattening of case versions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>emo <span class="ot">&lt;-</span> Demo[Demo[,.I<span class="sc">%in%</span><span class="fu">c</span>(Demo[,.I[.N],<span class="at">by=</span><span class="st">"caseid"</span>]<span class="sc">$</span>V1)]]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"caseversion"</span>,<span class="st">"sex"</span>,<span class="st">"quarter"</span>,<span class="st">"i_f_cod"</span>,<span class="st">"rept_cod"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">"occp_cod"</span>,<span class="st">"e_sub"</span>,<span class="st">"age_grp"</span>,<span class="st">"occr_country"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">"reporter_country"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>Demo[,(cols)<span class="sc">:</span><span class="er">=</span><span class="fu">lapply</span>(.SD, as.factor),.SDcols<span class="ot">=</span>cols]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-duplicated-manufacturer-ids" class="level2">
<h2 class="anchored" data-anchor-id="remove-duplicated-manufacturer-ids">9. Remove duplicated manufacturer ids</h2>
<p>Subsequently, we analyzed duplicated mfr_num records (given the same manufacturer sender). Although these entries were more diverse, there were indications that they likely referred to the same case. We selected the most recent entry, prioritizing first based on fda_date and then on position.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[<span class="fu">order</span>(fda_dt)]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[Demo[,.I<span class="sc">%in%</span><span class="fu">c</span>(Demo[,.I[.N],<span class="at">by=</span><span class="fu">c</span>(<span class="st">"mfr_num"</span>,<span class="st">"mfr_sndr"</span>)]<span class="sc">$</span>V1,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                           Demo[,<span class="fu">which</span>(<span class="fu">is.na</span>(mfr_num))],</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                           Demo[,<span class="fu">which</span>(<span class="fu">is.na</span>(mfr_sndr))])]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="removing-reports-without-drug-or-reaction" class="level2">
<h2 class="anchored" data-anchor-id="removing-reports-without-drug-or-reaction">10. Removing reports without drug or reaction</h2>
<p>To comply with FAERS indications, for which each report is characterized by at least one drug and one event, we removed all DEMO cases for which information of either reaction or drug was missing.</p>
<p>To implement this, our first step involved removing all rows from the DRUG dataset that referred to either no medication or were left unspecified. When it came to untranslated substances, we made a decision not to exclude them. However, for disproportionality analysis, it is advisable for the authors to extend the translation of the drug of interest. By doing so, they can prevent cases from being included in the denominator, leading to more accurate results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Clean Data/DRUG.rds"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Clean Data/REAC.rds"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[<span class="sc">!</span>Substance<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"no medication"</span>,<span class="st">"unspecified"</span>)]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> Reac[<span class="sc">!</span>pt<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"no adverse event"</span>)]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>no_drugs <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(Demo<span class="sc">$</span>primaryid),<span class="fu">unique</span>(Drug<span class="sc">$</span>primaryid))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>no_event <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(Demo<span class="sc">$</span>primaryid),<span class="fu">unique</span>(Reac<span class="sc">$</span>primaryid))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>not_complete <span class="ot">&lt;-</span> <span class="fu">union</span>(no_drugs,no_event)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[<span class="sc">!</span>primaryid <span class="sc">%in%</span> not_complete]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identification-of-pre-marketing-cases" class="level2">
<h2 class="anchored" data-anchor-id="identification-of-pre-marketing-cases">10. Identification of pre-marketing cases</h2>
<p>After considering the drug name and referring to the DIANA dictionary translation, we were able to identify reports originating from the pre-marketing phase. This identification process took into account situations where the medicinal product was named using pre-registration numbers or in the context of a trial (e.g., together with a placebo). This information may be useful to authors wishing to exclude pre-marketing evidence from the reports. These authors may consider also excluding reports from the literature (see lit_ref).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Identify pre-marketing -----------------------------------------------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Demo[,premarketing<span class="sc">:</span><span class="er">=</span>primaryid<span class="sc">%in%</span>Drug[trial<span class="sc">==</span><span class="cn">TRUE</span>]<span class="sc">$</span>primaryid]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>Demo[,literature<span class="sc">:</span><span class="er">=</span><span class="sc">!</span><span class="fu">is.na</span>(lit_ref)]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="st">"Clean Data/DEMO.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-datasets-from-excluded-primaryids" class="level2">
<h2 class="anchored" data-anchor-id="clean-datasets-from-excluded-primaryids">11. Clean datasets from excluded primaryids</h2>
<p>Here we removed the excluded primaryid from each database, and we split the datasets to make them more easy to be managed by the computer during the analysis.</p>
<p><img src="images/Flowchart-Page-14%20(1).jpg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace the name of the directory</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># according to the last quarter downloaded</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>data_directory <span class="ot">&lt;-</span> <span class="st">"Data/23Q1"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(data_directory)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>Demo_Supp <span class="ot">&lt;-</span>  Demo[,.(primaryid,caseid,caseversion,i_f_cod,auth_num,e_sub,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                      lit_ref,rept_dt,to_mfr,mfr_sndr,mfr_num,mfr_dt,quarter)]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo_Supp,<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO_SUPP.rds"</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> Demo[,.(primaryid,sex,age_in_days,wt_in_kgs,occr_country,event_dt,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                occp_cod,reporter_country,rept_cod,init_fda_dt,fda_dt,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                premarketing,literature)]</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO.rds"</span>))</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[primaryid <span class="sc">%in%</span> Demo<span class="sc">$</span>primaryid]</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>Drug_Name <span class="ot">&lt;-</span> Drug[,.(primaryid,drug_seq,drugname,prod_ai)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Drug_Name,<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG_NAME.rds"</span>))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug_Name)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> Drug[,.(primaryid,drug_seq,<span class="at">substance=</span>Substance,role_cod)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>Drug<span class="sc">$</span>role_cod <span class="ot">&lt;-</span> <span class="fu">factor</span>(Drug<span class="sc">$</span>role_cod,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"C"</span>,<span class="st">"I"</span>,<span class="st">"SS"</span>,<span class="st">"PS"</span>),</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Drug,<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG.rds"</span>))</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> Reac[primaryid <span class="sc">%in%</span> Demo<span class="sc">$</span>primaryid]</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>meddra_primary <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">read_csv2</span>(<span class="st">"External Sources/Dictionaries/MedDRA/meddra_primary.csv"</span>))</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(meddra_primary,<span class="fu">c</span>(<span class="st">"soc"</span>,<span class="st">"hlgt"</span>,<span class="st">"hlt"</span>,<span class="st">"pt"</span>))</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> Reac[,.(primaryid,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">pt=</span><span class="fu">factor</span>(pt,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span>meddra_primary<span class="sc">$</span>pt,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ordered=</span><span class="cn">TRUE</span>),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">drug_rec_act =</span> <span class="fu">factor</span>(drug_rec_act,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">levels=</span>meddra_primary<span class="sc">$</span>pt,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">ordered=</span><span class="cn">TRUE</span>))]</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Reac,<span class="fu">paste0</span>(data_directory,<span class="st">"/REAC.rds"</span>))</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Reac)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>Outc <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/Outc.rds"</span>))</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>Outc <span class="ot">&lt;-</span> Outc[primaryid <span class="sc">%in%</span> Demo<span class="sc">$</span>primaryid][</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>  ,.(primaryid,<span class="at">outc_cod=</span><span class="fu">factor</span>(outc_cod,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"OT"</span>, <span class="st">"CA"</span>, <span class="st">"HO"</span>, <span class="st">"RI"</span>,</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"DS"</span>, <span class="st">"LT"</span>, <span class="st">"DE"</span>),</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ordered =</span> <span class="cn">TRUE</span>))] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Outc,<span class="fu">paste0</span>(data_directory,<span class="st">"/OUTC.rds"</span>))</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Outc)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>Indi <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/Indi.rds"</span>))</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>Indi <span class="ot">&lt;-</span> Indi[primaryid <span class="sc">%in%</span> Demo<span class="sc">$</span>primaryid]</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>Indi <span class="ot">&lt;-</span> Indi[,.(primaryid,drug_seq,</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">indi_pt=</span> <span class="fu">factor</span>(indi_pt,</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">levels=</span>meddra_primary<span class="sc">$</span>pt,</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ordered=</span><span class="cn">TRUE</span>))] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Indi,<span class="fu">paste0</span>(data_directory,<span class="st">"/INDI.rds"</span>))</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Indi)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/Ther.rds"</span>))</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>Ther <span class="ot">&lt;-</span> Ther[primaryid<span class="sc">%in%</span>Demo<span class="sc">$</span>primaryid][,.(primaryid,drug_seq,start_dt,</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>                                             dur_in_days,end_dt,time_to_onset,</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>                                             event_dt)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Ther,<span class="fu">paste0</span>(data_directory,<span class="st">"/THER.rds"</span>))</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Ther)</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>Drug_Info <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/Drug_info.rds"</span>))</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>Drug_Info <span class="ot">&lt;-</span> Drug_Info[primaryid<span class="sc">%in%</span>Demo<span class="sc">$</span>primaryid]</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>Doses <span class="ot">&lt;-</span>  Drug_Info[,.(primaryid,drug_seq,dose_vbm,cum_dose_unit,cum_dose_chr,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>                       dose_amt,dose_unit,dose_freq)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Doses,<span class="fu">paste0</span>(data_directory,<span class="st">"/DOSES.rds"</span>))</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Doses)</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>Drug_Supp <span class="ot">&lt;-</span> Drug_Info[,.(primaryid,drug_seq,route,dose_form,dechal,rechal,</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>                          lot_num,exp_dt)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>Drug_Supp <span class="ot">&lt;-</span> Drug_Supp[,dose_form<span class="sc">:</span><span class="er">=</span><span class="fu">factor</span>(dose_form)]</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Drug_Supp,<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG_SUPP.rds"</span>))</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug_Supp)</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>Drug_Name <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG_NAME.rds"</span>)))</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>Drug_Name <span class="ot">&lt;-</span> Drug_Info[,.(primaryid,drug_seq,val_vbm,nda_num)][</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>  Drug_Name,on<span class="ot">=</span><span class="fu">c</span>(<span class="st">"primaryid"</span>,<span class="st">"drug_seq"</span>)]</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Drug_Name,<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG_NAME.rds"</span>))</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug_Name)</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug_Info)</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>Rpsr <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="st">"Clean Data/Rpsr.rds"</span>))</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>Demo_Supp <span class="ot">&lt;-</span> Rpsr[,.(primaryid,<span class="at">rpsr_cod=</span><span class="fu">factor</span>(rpsr_cod))][Demo_Supp,</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>                                                           on<span class="ot">=</span><span class="st">"primaryid"</span>]</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo_Supp,<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO_SUPP.rds"</span>))</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rule-based-deduplication" class="level2">
<h2 class="anchored" data-anchor-id="rule-based-deduplication">12. Rule-based deduplication</h2>
<p>We included, in the Demo dataset, two columns specifying whether the report is a plausible duplicate or not based on two commonly used algorithm, one more conservative (RB_duplicates) that searches for exactly the same values in the date of event, sex, reporter_country, age, weight, list of PTs and list of drugs, and one more speculative (RB_duplicates_only_susp) assessing among the drugs only the suspected ones. The conservative algorithm tagged 2835936 potential duplicates, the speculative one 3275048 potential duplicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace the name of the directory</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># according to the last quarter downloaded</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>data_directory <span class="ot">&lt;-</span> <span class="st">"Data/23Q1"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>Reac <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(data_directory,<span class="st">"/REAC.rds"</span>)))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>Demo <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO.rds"</span>)))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">setDT</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(data_directory,<span class="st">"/DRUG.rds"</span>)))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>complete_duplicates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"event_dt"</span>,<span class="st">"sex"</span>,<span class="st">"reporter_country"</span>,<span class="st">"age_in_days"</span>,<span class="st">"wt_in_kgs"</span>,<span class="st">"pt"</span>,<span class="st">"PS"</span>,<span class="st">"SS"</span>,<span class="st">"IC"</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>temp_reac <span class="ot">&lt;-</span> Reac[<span class="fu">order</span>(pt)][,.(<span class="at">pt=</span><span class="fu">paste0</span>(pt,<span class="at">collapse=</span><span class="st">"; "</span>)),by<span class="ot">=</span><span class="st">"primaryid"</span>] <span class="sc">%&gt;%</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>temp_drug_PS <span class="ot">&lt;-</span> Drug[<span class="fu">order</span>(substance)][role_cod<span class="sc">==</span><span class="st">"PS"</span>][</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  ,.(<span class="at">PS=</span><span class="fu">paste0</span>(substance,<span class="at">collapse=</span><span class="st">"; "</span>)),by<span class="ot">=</span><span class="st">"primaryid"</span>] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>temp_drug_SS <span class="ot">&lt;-</span> Drug[<span class="fu">order</span>(substance)][role_cod<span class="sc">==</span><span class="st">"SS"</span>][</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  ,.(<span class="at">SS=</span><span class="fu">paste0</span>(substance,<span class="at">collapse=</span><span class="st">"; "</span>)),by<span class="ot">=</span><span class="st">"primaryid"</span>] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>temp_drug_IC <span class="ot">&lt;-</span> Drug[<span class="fu">order</span>(substance)][role_cod<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"I"</span>,<span class="st">"C"</span>)][</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  ,.(<span class="at">IC=</span><span class="fu">paste0</span>(substance,<span class="at">collapse=</span><span class="st">"; "</span>)),by<span class="ot">=</span><span class="st">"primaryid"</span>] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>temp_drug_suspected <span class="ot">&lt;-</span> Drug[<span class="fu">order</span>(substance)][role_cod<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"PS"</span>,<span class="st">"SS"</span>)][</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  ,.(<span class="at">suspected=</span><span class="fu">paste0</span>(substance,<span class="at">collapse=</span><span class="st">"; "</span>)),by<span class="ot">=</span><span class="st">"primaryid"</span>] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp_reac[temp_drug_suspected[temp_drug_IC[temp_drug_SS[temp_drug_PS[Demo,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                                                                             on<span class="ot">=</span><span class="st">"primaryid"</span>],</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                                                                on<span class="ot">=</span><span class="st">"primaryid"</span>],</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                                                   on<span class="ot">=</span><span class="st">"primaryid"</span>],</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>                                      on<span class="ot">=</span><span class="st">"primaryid"</span>],on<span class="ot">=</span><span class="st">"primaryid"</span>]</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp_reac)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp_drug_PS)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp_drug_SS)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp_drug_IC)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp_drug_suspected)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[<span class="fu">order</span>(fda_dt)]</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>temp_grouped <span class="ot">&lt;-</span> temp[,DUP_ID<span class="sc">:</span><span class="er">=</span>.GRP,by<span class="ot">=</span>complete_duplicates]</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>singlets_pids <span class="ot">&lt;-</span> temp_grouped[DUP_ID <span class="sc">%in%</span> temp_grouped[,.N,by<span class="ot">=</span><span class="st">"DUP_ID"</span>][N<span class="sc">==</span><span class="dv">1</span>]<span class="sc">$</span>DUP_ID]<span class="sc">$</span>primaryid</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> temp_grouped[<span class="sc">!</span>primaryid <span class="sc">%in%</span> singlets_pids]</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>duplicates_pids <span class="ot">&lt;-</span> duplicates[duplicates[,.I[primaryid<span class="sc">==</span><span class="fu">last</span>(primaryid)],by<span class="ot">=</span><span class="st">"DUP_ID"</span>]<span class="sc">$</span>V1]<span class="sc">$</span>primaryid</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>Demo[,RB_duplicates<span class="sc">:</span><span class="er">=</span><span class="sc">!</span>primaryid<span class="sc">%in%</span> <span class="fu">c</span>(singlets_pids,duplicates_pids)]</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO.rds"</span>))</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="do">##and based only on suspect drugs</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>complete_duplicates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"event_dt"</span>,<span class="st">"sex"</span>,<span class="st">"reporter_country"</span>,<span class="st">"age_in_days"</span>,<span class="st">"wt_in_kgs"</span>,<span class="st">"pt"</span>,<span class="st">"suspected"</span>)</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>temp_grouped <span class="ot">&lt;-</span> temp[,DUP_ID<span class="sc">:</span><span class="er">=</span>.GRP,by<span class="ot">=</span>complete_duplicates]</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>singlets_pids <span class="ot">&lt;-</span> temp_grouped[DUP_ID <span class="sc">%in%</span> temp_grouped[,.N,by<span class="ot">=</span><span class="st">"DUP_ID"</span>][N<span class="sc">==</span><span class="dv">1</span>]<span class="sc">$</span>DUP_ID]<span class="sc">$</span>primaryid</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> temp_grouped[<span class="sc">!</span>primaryid <span class="sc">%in%</span> singlets_pids]</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>duplicates_pids <span class="ot">&lt;-</span> duplicates[duplicates[,.I[primaryid<span class="sc">==</span><span class="fu">last</span>(primaryid)],by<span class="ot">=</span><span class="st">"DUP_ID"</span>]<span class="sc">$</span>V1]<span class="sc">$</span>primaryid</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>Demo[,RB_duplicates_only_susp<span class="sc">:</span><span class="er">=</span><span class="sc">!</span>primaryid<span class="sc">%in%</span> <span class="fu">c</span>(singlets_pids,duplicates_pids)]</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Demo,<span class="fu">paste0</span>(data_directory,<span class="st">"/DEMO.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="probabilistic-deduplication" class="level2">
<h2 class="anchored" data-anchor-id="probabilistic-deduplication">13. Probabilistic deduplication</h2>
<p>Nonetheless, mistakes and incompleteness should be taken into account when searching for duplicates. To account for these problems probabilistc algorithms can be implemented, but require higher computing power.</p>
<p>WORK IN PROGRESS</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>